<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"nikrot.github.io","root":"/","scheme":"Pisces","version":"7.7.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Nikrot">
<meta property="og:url" content="http://nikrot.github.io/index.html">
<meta property="og:site_name" content="Nikrot">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Nikrot">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://nikrot.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false
  };
</script>

  <title>Nikrot</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Nikrot</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://nikrot.github.io/2021/03/15/Stable-Roommates-Problem/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Nikrot">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nikrot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/15/Stable-Roommates-Problem/" class="post-title-link" itemprop="url">稳定室友问题</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-03-15 00:00:00" itemprop="dateCreated datePublished" datetime="2021-03-15T00:00:00+08:00">2021-03-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-16 11:39:15" itemprop="dateModified" datetime="2021-03-16T11:39:15+08:00">2021-03-16</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="稳定室友问题"><a href="#稳定室友问题" class="headerlink" title="稳定室友问题"></a>稳定室友问题</h1><p>即稳定婚姻问题的无性别版($2n$个人找室友，两两配对，每个人都有自己的偏好，不能有不稳定对存在)</p>
<p><del>下面开始翻译</del></p>
<p>存在一种$O(n^2)$的算法，在1985年由$\texttt{Robert W. Irving}$ 提出。</p>
<p>$\text {Part I}$：</p>
<p>首先把一个人拆成两个人，按照稳定婚姻问题正常做，这样可以让每个人得到自己的一个候选人。为了方便，设偏好表为$T$。</p>
<p>考虑$p,q$二人，若$p$的候选人为$q$，那么我们把$q$的偏好表$T_q$中排在$p$后的都删去，同时对称地对于每一个被删去的人$x$,从$T_x$中删去$q$。把这个操作对所有满足条件的$p,q$都做一遍，如果有任意一个人的偏好表被删光，那么原问题无解。否则对于任意$p,q$有$\operatorname{First}(T_p)=q,\operatorname{Last}(T_q)=p$，其中$\operatorname{First}(T_p)=T_{p,1}$,为$p$的偏好表中的首项，类似地，$\operatorname{Last}$为末项。我们称这一步得到的偏好表为“稳定表”，记为$T’$。</p>
<p>这个稳定表满足以下条件：</p>
<ol>
<li><p>$\operatorname{First}(T’_p)=q\iff\operatorname{Last}(T’_q)=p$</p>
</li>
<li><p>$p\notin T’_q \iff q\notin T’_p\iff \operatorname{Rank}_q(\operatorname{Last}(T’_q))&gt;\operatorname{Rank}_q(p) \or \operatorname{Rank}_p(\operatorname{Last}(T’_p))&gt;\operatorname{Rank}_p(q)$,其中$\operatorname{Rank}_q(p)$表示$p$在$q$的偏好表中的排名。</p>
</li>
<li><p>$T’_p$非空</p>
</li>
</ol>
<p>它有以下性质：</p>
<ol>
<li><p>任一稳定表为$T$的子偏好表。</p>
</li>
<li><p>若$\forall q,|T’_q|=1$，则所有人的偏好表中的人构成一个合法解。</p>
</li>
<li><p>若原问题有解，任一稳定表中都存在一个解。</p>
</li>
<li><p>任何$T’_q$的子稳定表，都可以通过由$T’_q$进行一系列旋转删除得到（后文会讲）。</p>
</li>
</ol>
<p>$\text{Part II}$：</p>
<p>如果$T_q$满足稳定表的性质2，那么找到一组合法解，退出。</p>
<p>定义一组旋转为$(x_0,y_0),(x_1,y_1),(x_2,y_2),\dots ,(x_{k-1},y_{k-1})$，使得所有$x_i$互不相同，且$\forall i\in [0,k),T’_{x_i,1}=y_i,T’_{x_i,2}=y_{i+1}\dots$（下标均为模$k$意义下）。如果$\exists i\in [0,k),|T’_i|&gt;2$,则一定存在一组旋转。要找到一组旋转，令$p_0$为满足上述条件的任一$i$,令$q_{j+1}=T_{p_j,0},p_{j+1}=\operatorname{Last}(T_{q_{j+1}})$，一直循环直到找到一个重复的$p_j$为止，则其第一次出现到其最后一次出现前为一次合法的旋转（就像Pollard-Rho里的环）。同时记从$i$到$p_j$为止的二元组为旋转的尾部（即$\rho$的尾巴）</p>
<p>一次旋转删除为:令$y_0$拒绝$x_0$（根据上文的条件此时$x_0$的候选人为$y_0$），使$x_0$与$y_1$匹配，同理令$y_1$拒绝$x_1$……这样循环地拒绝并重新选择候选人。如果任一$T_q$被删光则无解，否则返回判断步骤。容易发现$T’$的大小每次循环都会减小。</p>
<p>为了达到$O(n^2)$的时间复杂度，$\operatorname{Rank}$函数需要被以一个数组的形式维护，同时维护当前旋转的起始点找到了哪一位置（在该位置之前的均不可能是起始点）</p>
<p>同时也可以维护旋转的尾部（若有），每次若可能的话都从尾部开始以免重复寻找。</p>
<p><del>翻译结束</del></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://nikrot.github.io/2020/07/18/solution-CF875F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Nikrot">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nikrot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/18/solution-CF875F/" class="post-title-link" itemprop="url">Codeforces 875F Royal Questions</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-07-18 09:58:30 / 修改时间：10:31:38" itemprop="dateCreated datePublished" datetime="2020-07-18T09:58:30+08:00">2020-07-18</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>第一眼:网络流板子题！交了两发: TLE on test 15……</p>
<p>然后<del>因为输入格式像一张在输入一张图，</del>考虑根据输入建图。发现原问题等价于选择一个边权和尽珂能大的边集，使得任意一个连通块内最多只有1个环。</p>
<p>那么原问题等价于:求图的“最大生成基环树森林”</p>
<p>然后按照Kruskal的思想做就珂以了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">200005</span>;</span><br><span class="line"><span class="keyword">using</span> ll = <span class="keyword">long</span> <span class="keyword">long</span>;</span><br><span class="line"><span class="keyword">int</span> n,m,f[N],cyc[N];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span><span class="keyword">int</span> u,v,w;&#125; e[N];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getf</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123;<span class="keyword">return</span> f[v] == v ? v : f[v] = getf(f[v]);&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++) <span class="built_in">cin</span> &gt;&gt; e[i].u &gt;&gt; e[i].v &gt;&gt; e[i].w;</span><br><span class="line">    sort(e + <span class="number">1</span>,e + m + <span class="number">1</span>,[](Edge a,Edge b) &#123;<span class="keyword">return</span> a.w &gt; b.w;&#125;);</span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) f[i] = i;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> u = getf(e[i].u),v = getf(e[i].v);</span><br><span class="line">        <span class="keyword">if</span> (u == v)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (!cyc[u]) ans += e[i].w,cyc[u] = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (cyc[u] &amp;&amp; cyc[v]) <span class="keyword">continue</span>;</span><br><span class="line">        f[u] = v;cyc[v] |= cyc[u];ans += e[i].w;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://nikrot.github.io/2020/07/11/solution-CF1332F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Nikrot">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nikrot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/11/solution-CF1332F/" class="post-title-link" itemprop="url">Codeforces 1332F Independent Set</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-11 11:42:09" itemprop="dateCreated datePublished" datetime="2020-07-11T11:42:09+08:00">2020-07-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-14 13:40:54" itemprop="dateModified" datetime="2020-07-14T13:40:54+08:00">2020-07-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>题意:求一棵树的所有非空边导出子图的独立集个数和。</p>
<p>算法：窝先设 $dp_{pos,k}$ 表示第 $pos$ 个位置是否选进独立集。然后——显然挂了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DP多简单啊，不会的就加一维嘛</span><br></pre></td></tr></table></figure>
<p>改状态为 $dp_{pos,k,j}$ , 其中 $k=0$ 表示没有选进导出子图，$k=1$ 表示选进导出子图但没有选进独立集， $k=2$ 表示选进独立集， $j$ 表示与儿子有无边相连(如果没有的话还需 $pos$ 的父亲与$pos$连边才能将其选进导出子图)</p>
<p>转移时发现 $dp_{pos,0,1}$ 是无效状态， $dp_{pos,0,0}=dp_{pos,1,0}=dp_{pos,2,0}$ ……</p>
<p>因此缩减状态</p>
<p>令状态为 $dp_{pos,k}$ ,其中</p>
<p>$k=0$  不选入子图/选入子图但选入独立集状态待定且与儿子无边相连<br>$k=1$  选入子图，不选入独立集，与至少一个儿子有边相连<br>$k=2$  选入子图，选入独立集，与至少一个儿子有边相连</p>
<p>转移见代码。</p>
<p>然而这个菜鸡在统计答案的时候出错了… 窝一开始写的代码是 $Ans=\sum\limits_{k=1}^n dp_{k,1}+dp_{k,2}$ 。即枚举根节点，假设根节点必须选入后统计。但事实上在导出子图在两棵不同的子树内的情况也是合法的…</p>
<p>因此， $Ans=dp_{r,0}+dp_{r,1}+dp_{r,2}-1$ ，其中$r$为选定的树根，$-1$是因为要去掉边导出子图为空时的情况(此时独立集也为空)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">300005</span>,P = <span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">using</span> ll = <span class="keyword">long</span> <span class="keyword">long</span>;</span><br><span class="line"><span class="function">ll <span class="title">qpow</span><span class="params">(ll a,ll b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll ret = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (b)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>) ret = ret * a % P;</span><br><span class="line">        a = a * a % P;b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">inv</span><span class="params">(ll a)</span> </span>&#123;<span class="keyword">return</span> qpow(a,P - <span class="number">2</span>);&#125;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; v[N];</span><br><span class="line"><span class="keyword">int</span> n;ll dp[N][<span class="number">3</span>];</span><br><span class="line"><span class="comment">// [0]:不选入子图/选入子图但选入独立集状态待定且与儿子无边相连</span></span><br><span class="line"><span class="comment">// [1]:选入子图，不选入独立集，与至少一个儿子有边相连</span></span><br><span class="line"><span class="comment">// [2]:选入子图，选入独立集，与至少一个儿子有边相连</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">mul</span><span class="params">(ll &amp;a,ll b)</span> </span>&#123;a = a * (b % P) % P;&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(ll &amp;a,ll b)</span> </span>&#123;a = (a + b) % P;&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> fa)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    dp[pos][<span class="number">0</span>] = dp[pos][<span class="number">1</span>] = dp[pos][<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;i : v[pos])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (i == fa) <span class="keyword">continue</span>;</span><br><span class="line">        dfs(i,pos);</span><br><span class="line">        mul(dp[pos][<span class="number">0</span>],dp[i][<span class="number">0</span>] + dp[i][<span class="number">1</span>] + dp[i][<span class="number">2</span>]);</span><br><span class="line">        mul(dp[pos][<span class="number">1</span>],dp[i][<span class="number">0</span>] + dp[i][<span class="number">0</span>] + dp[i][<span class="number">0</span>] + dp[i][<span class="number">1</span>] * <span class="number">2</span> + dp[i][<span class="number">2</span>] * <span class="number">2</span>);</span><br><span class="line">        mul(dp[pos][<span class="number">2</span>],dp[i][<span class="number">0</span>] + dp[i][<span class="number">0</span>] + dp[i][<span class="number">1</span>] * <span class="number">2</span> + dp[i][<span class="number">2</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    add(dp[pos][<span class="number">1</span>],P - dp[pos][<span class="number">0</span>]);add(dp[pos][<span class="number">2</span>],P - dp[pos][<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n;<span class="keyword">int</span> t1,t2;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; t1 &gt;&gt; t2,v[t1].push_back(t2),v[t2].push_back(t1);</span><br><span class="line">    dfs(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    ll ans = <span class="number">0</span>;add(ans,dp[<span class="number">1</span>][<span class="number">0</span>] + dp[<span class="number">1</span>][<span class="number">1</span>] + dp[<span class="number">1</span>][<span class="number">2</span>] - <span class="number">1</span> + P);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://nikrot.github.io/2020/06/26/solution-CF1361C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Nikrot">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nikrot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/26/solution-CF1361C/" class="post-title-link" itemprop="url">Codeforces 1361C Johnny and Megan's Necklace</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-26 12:00:42" itemprop="dateCreated datePublished" datetime="2020-06-26T12:00:42+08:00">2020-06-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-27 11:02:59" itemprop="dateModified" datetime="2020-06-27T11:02:59+08:00">2020-06-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>题意: 给定$n$个二元组$(a_i,b_i)$，现在要将它们串成一个环，一个二元组的$b$元素不一定要与另一个二元组的$a$元素相邻。如果一个二元组的$X$元素与另一个二元组的$Y$元素的位置在环上相邻，则其权值为$\log_2\operatorname{lowbit}(X\oplus Y)$。特殊地，如果$X=Y$则权值为$20$。定义一个环的权值为所有相邻二元组的权值的最小值，要求输出这些二元组能够组成的环的最大权值和对应最大权值的一种方案。</p>
<p>做法:</p>
<p>考虑从20开始从大到小枚举答案$Ans$。则每次只需考虑二元组中数字的最后$Ans$位即可。</p>
<p>将每个二元组的$(a_i,b_i)$之间连边，如果有欧拉回路则说明$Ans$合法，否则$Ans$不合法。</p>
<p>然而输出方案的代码让蒟蒻调试了好久…(其实主要还是求欧拉回路的<code>dfs</code>函数里那行删除无用边的复杂度<strong>看似</strong>正确的代码没有加）</p>
<p>另一种删除无用边的写法类似于网络流的当前弧优化，这种方法复杂度正确。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1000005</span>,M = <span class="number">1</span> &lt;&lt; <span class="number">20</span>;</span><br><span class="line"><span class="keyword">int</span> n,a[N],deg[M],f[M];</span><br><span class="line"><span class="keyword">int</span> head[M],v[N],w[N],nxt[N],ptr;pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; id[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">add_edge</span><span class="params">(<span class="keyword">int</span> uu,<span class="keyword">int</span> vv,pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; dd)</span></span></span><br><span class="line"><span class="function"></span>&#123;assert(ptr &lt; N);v[ptr] = vv;id[ptr] = dd;nxt[ptr] = head[uu];head[uu] = ptr++;&#125;</span><br><span class="line">pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; out[N];<span class="keyword">int</span> idx;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(T &amp;num)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    num = <span class="number">0</span>;<span class="keyword">int</span> ch = getchar();T fl = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch) &amp;&amp; ch != <span class="number">45</span>) ch = getchar();</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="number">45</span>) fl = <span class="number">-1</span>,ch = getchar();</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) </span><br><span class="line">    &#123;num = (num &lt;&lt; <span class="number">3</span>) + (num &lt;&lt; <span class="number">1</span>) + (ch - <span class="number">48</span>);ch = getchar();&#125;</span><br><span class="line">    num *= fl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">write</span><span class="params">(T num)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> buf[<span class="number">55</span>];<span class="keyword">static</span> <span class="keyword">int</span> idx = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (num == <span class="number">0</span>) &#123;<span class="built_in">putchar</span>(<span class="number">48</span>);<span class="keyword">return</span>;&#125;</span><br><span class="line">    <span class="keyword">if</span> (num &lt; <span class="number">0</span>) &#123;<span class="built_in">putchar</span>(<span class="number">45</span>);num = -num;&#125;</span><br><span class="line">    <span class="keyword">while</span> (num) &#123; buf[idx++] = num % <span class="number">10</span>;num /= <span class="number">10</span>; &#125;</span><br><span class="line">    <span class="keyword">while</span> (idx) <span class="built_in">putchar</span>(buf[--idx] + <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> pos)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> pos)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// for (int i = head[pos];i != -1;i = nxt[i])</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">//     while (nxt[i] != -1 &amp;&amp; w[nxt[i]]) nxt[i] = nxt[nxt[i]]; // 删掉后会TLE(然鹅其实复杂度还是错的)</span></span><br><span class="line">    <span class="comment">//     if (!w[i]) w[i] = w[i ^ 1] = 1,dfs(v[i]),out[++idx] = id[i];</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> &amp;i = head[pos];i != <span class="number">-1</span>;i == <span class="number">-1</span> ? <span class="number">0</span> : i = nxt[i]) <span class="comment">// 这样写复杂度是正确的</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> tmp = i;</span><br><span class="line">        <span class="keyword">if</span> (!w[i]) w[i] = w[i ^ <span class="number">1</span>] = <span class="number">1</span>,dfs(v[i]),out[++idx] = id[tmp];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">getf</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123;<span class="keyword">return</span> f[v] == v ? v : f[v] = getf(f[v]);&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);<span class="built_in">cin</span>.tie(<span class="number">0</span>);</span><br><span class="line">    read(n);<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) read(a[i * <span class="number">2</span> - <span class="number">1</span>]),read(a[i * <span class="number">2</span>]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> ans = <span class="number">20</span>;ans &gt; <span class="number">0</span>;--ans)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n * <span class="number">2</span>;i++) a[i] &amp;= (<span class="number">1</span> &lt;&lt; ans) - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; (<span class="number">1</span> &lt;&lt; ans);i++) deg[i] = <span class="number">0</span>,f[i] = i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n * <span class="number">2</span>;i++) ++deg[a[i]];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n * <span class="number">2</span>;i += <span class="number">2</span>) f[getf(a[i])] = getf(a[i + <span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">bool</span> ok = <span class="number">1</span>;<span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; (<span class="number">1</span> &lt;&lt; ans) &amp;&amp; ok;i++) <span class="keyword">if</span> (deg[i] % <span class="number">2</span>) ok = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n * <span class="number">2</span> &amp;&amp; ok;i++) <span class="keyword">if</span> (f[a[i]] == a[i]) ++cnt,f[a[i]] = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">if</span> (!ok || cnt != <span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">        write(ans);<span class="built_in">putchar</span>(<span class="string">'\n'</span>);</span><br><span class="line">        <span class="built_in">memset</span>(head,<span class="number">-1</span>,<span class="keyword">sizeof</span>(head));<span class="built_in">memset</span>(nxt,<span class="number">-1</span>,<span class="keyword">sizeof</span>(nxt));</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n * <span class="number">2</span>;i += <span class="number">2</span>)</span><br><span class="line">            add_edge(a[i],a[i + <span class="number">1</span>],&#123;i,i + <span class="number">1</span>&#125;),add_edge(a[i + <span class="number">1</span>],a[i],&#123;i + <span class="number">1</span>,i&#125;);</span><br><span class="line">        dfs(a[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = idx;i &gt; <span class="number">0</span>;--i)</span><br><span class="line">            write(out[i].first),<span class="built_in">putchar</span>(<span class="string">' '</span>),write(out[i].second),<span class="built_in">putchar</span>(<span class="string">' '</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="number">0</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n * <span class="number">2</span>;i++) <span class="built_in">cout</span> &lt;&lt; i &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://nikrot.github.io/2020/06/25/solution-CF575I/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Nikrot">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nikrot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/25/solution-CF575I/" class="post-title-link" itemprop="url">CF575I Robots protection</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-25 08:52:21" itemprop="dateCreated datePublished" datetime="2020-06-25T08:52:21+08:00">2020-06-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-27 11:03:25" itemprop="dateModified" datetime="2020-06-27T11:03:25+08:00">2020-06-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>转载一下xht37神犇的题解…</p>
<p>$n$很小，因此开二维树状数组即可。</p>
<p>随后大力分类讨论:</p>
<p><img src="/2020/06/25/solution-CF575I/casework.png" alt="Casework"></p>
<p>(图来自兔)<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">10005</span>,M = <span class="number">100005</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;<span class="keyword">return</span> x &amp; -x;&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Op</span> &#123;</span><span class="keyword">int</span> x,y,v;&#125; tt[M];<span class="keyword">int</span> ptr,xx,yy,c[N][N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> v,<span class="keyword">bool</span> del = <span class="number">0</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!del) tt[++ptr] = &#123;x,y,v&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = x;i &lt;= xx;i += lowbit(i))</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = y;j &lt;= yy;j += lowbit(j)) c[i][j] += v;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = x;i;i -= lowbit(i))</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = y;j;j -= lowbit(j)) ret += c[i][j];</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123; <span class="keyword">while</span> (ptr) add(tt[ptr].x,tt[ptr].y,-tt[ptr].v,<span class="number">1</span>),--ptr; &#125;</span><br><span class="line"><span class="keyword">int</span> n,m,tp[M],x[M],y[M],dir[M],v[M],ans[M];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; tp[i];</span><br><span class="line">        <span class="keyword">if</span> (tp[i] == <span class="number">1</span>) <span class="built_in">cin</span> &gt;&gt; dir[i] &gt;&gt; x[i] &gt;&gt; y[i] &gt;&gt; v[i];</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">cin</span> &gt;&gt; x[i] &gt;&gt; y[i];</span><br><span class="line">    &#125;</span><br><span class="line">    xx = n;yy = n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++) <span class="comment">// Rt</span></span><br><span class="line">        <span class="keyword">if</span> (tp[i] == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (dir[i] == <span class="number">1</span>) add(x[i],y[i],<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (dir[i] == <span class="number">2</span>) add(x[i],y[i] + <span class="number">1</span>,<span class="number">-1</span>);</span><br><span class="line">            <span class="keyword">if</span> (dir[i] == <span class="number">3</span>) add(x[i] + <span class="number">1</span>,y[i],<span class="number">-1</span>);</span><br><span class="line">            <span class="keyword">if</span> (dir[i] == <span class="number">4</span>) add(x[i] + <span class="number">1</span>,y[i] + <span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> ans[i] += query(x[i],y[i]);</span><br><span class="line">    clear();</span><br><span class="line">    xx = n * <span class="number">2</span>;yy = n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++) <span class="comment">// -45~90</span></span><br><span class="line">        <span class="keyword">if</span> (tp[i] == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (dir[i] == <span class="number">1</span>) add(x[i] + y[i] + v[i] + <span class="number">1</span>,y[i],<span class="number">-1</span>);</span><br><span class="line">            <span class="keyword">if</span> (dir[i] == <span class="number">4</span>) add(x[i] + y[i] - v[i],y[i] + <span class="number">1</span>,<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> ans[i] += query(x[i] + y[i],y[i]);</span><br><span class="line">    clear();</span><br><span class="line">    xx = n;yy = n * <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++) <span class="comment">// -45~0</span></span><br><span class="line">        <span class="keyword">if</span> (tp[i] == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (dir[i] == <span class="number">1</span>) add(n - x[i] + <span class="number">1</span> + <span class="number">1</span>,x[i] + y[i] + v[i] + <span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (dir[i] == <span class="number">4</span>) add(n - x[i] + <span class="number">1</span>,x[i] + y[i] - v[i],<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> ans[i] += query(n - x[i] + <span class="number">1</span>,x[i] + y[i]);</span><br><span class="line">    clear();</span><br><span class="line">    xx = n * <span class="number">2</span>;yy = n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++) <span class="comment">// 45~90</span></span><br><span class="line">        <span class="keyword">if</span> (tp[i] == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (dir[i] == <span class="number">2</span>) add(n - y[i] + <span class="number">1</span> + x[i] + v[i] + <span class="number">1</span>,y[i] + <span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (dir[i] == <span class="number">3</span>) add(n - y[i] + <span class="number">1</span> + x[i] - v[i],y[i],<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> ans[i] += query(n - y[i] + <span class="number">1</span> + x[i],y[i]);</span><br><span class="line">    clear();</span><br><span class="line">    xx = n;yy = n * <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++) <span class="comment">// 0~45</span></span><br><span class="line">        <span class="keyword">if</span> (tp[i] == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (dir[i] == <span class="number">2</span>) add(x[i],n - x[i] + <span class="number">1</span> + y[i] - v[i],<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (dir[i] == <span class="number">3</span>) add(x[i] + <span class="number">1</span>,n - x[i] + <span class="number">1</span> + y[i] + v[i] + <span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> ans[i] += query(x[i],n - x[i] + <span class="number">1</span> + y[i]);</span><br><span class="line">    clear();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++) <span class="keyword">if</span> (tp[i] == <span class="number">2</span>) <span class="built_in">cout</span> &lt;&lt; ans[i] &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://nikrot.github.io/2020/06/24/solution-CF513F2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Nikrot">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nikrot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/24/solution-CF513F2/" class="post-title-link" itemprop="url">solution-CF513F2</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-24 20:55:49" itemprop="dateCreated datePublished" datetime="2020-06-24T20:55:49+08:00">2020-06-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-27 11:02:12" itemprop="dateModified" datetime="2020-06-27T11:02:12+08:00">2020-06-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>题意：在一张$n\times m$的地图上有一些障碍物。在一些位置上会有男人和女人。定义一个人“满足条件”为这个人所在的格子里有且仅有一个异性。另外还有一个中性人，即这个人和男女都是异性。每个人移动到地图上一个相邻且没有障碍物的格子需要一个独立的固定的时间$t_i$。问所有人(包括中性人)都“满足条件”需要多长时间。如果不能让所有人都满足条件输出-1。</p>
<p>做法：首先如果有解，同一个格子里不会有2个男人或2个女人。相对地，同一个格子里必定是一个男人和一个女人（假设中性人已经被定性）</p>
<p>同时，考虑如何处理中性人。令男人个数为$M$，女人个数为$F$，则$|M-F|\ne 1$是本题无解。否则珂以将中性人的性别定为人数少的一个性别。</p>
<p>接下来就是建图：首先二分答案$T$。</p>
<p>源点向所有男人连边，每个男人都向他在$T$个单位时间内珂以到达的房子连边。每个女人从她在$T$个单位时间内珂以到达的房子向她连边。所有女人都向汇点连边。</p>
<p>观察发现这样不能满足每个房子最多一对CP的条件，故将房子拆成入点和出点，男人连入点，入点连出点，出点连女人。</p>
<p>上述过程所有边的容量都为1。</p>
<p>同时要预处理每个房子到其他房子的以格子为单位的距离（会有障碍物，故不一定是曼哈顿距离，不能只处理可达性！这个蒟蒻因此WA了）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> ll = <span class="keyword">long</span> <span class="keyword">long</span>;</span><br><span class="line"><span class="keyword">int</span> n,m,l1,l2;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2005</span>,M = <span class="number">2000005</span>,K = <span class="number">25</span>;</span><br><span class="line"><span class="keyword">const</span> ll inf = LLONG_MAX &gt;&gt; <span class="number">5</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FlowGraph</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> head[N],v[M],nxt[M],ptr,t;</span><br><span class="line">    ll w[M];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">padd_edge</span><span class="params">(<span class="keyword">int</span> uu,<span class="keyword">int</span> vv,ll ww)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        v[ptr] = vv;w[ptr] = ww;</span><br><span class="line">        nxt[ptr] = head[uu];head[uu] = ptr++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> dis[N],cur[N];<span class="keyword">bool</span> vis[N];</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="keyword">sizeof</span>(vis));</span><br><span class="line">        <span class="built_in">memset</span>(dis,<span class="number">-1</span>,<span class="keyword">sizeof</span>(dis));</span><br><span class="line">        <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;q.push(s);</span><br><span class="line">        dis[s] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!q.empty())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> nd = q.front();q.pop();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = head[nd];i != <span class="number">-1</span>;i = nxt[i])</span><br><span class="line">                <span class="keyword">if</span> (w[i] &amp;&amp; dis[v[i]] == <span class="number">-1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    dis[v[i]] = dis[nd] + <span class="number">1</span>;</span><br><span class="line">                    q.push(v[i]);</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dis[t] != <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ll <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> pos,ll flow)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (pos == t) <span class="keyword">return</span> flow;</span><br><span class="line">        ll tmp = flow;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> &amp;i = cur[pos];i != <span class="number">-1</span>;i = nxt[i])</span><br><span class="line">            <span class="keyword">if</span> (w[i] &amp;&amp; dis[v[i]] == dis[pos] + <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                ll fl = dfs(v[i],min(flow,w[i]));</span><br><span class="line">                w[i] -= fl;w[i ^ <span class="number">1</span>] += fl;flow -= fl;</span><br><span class="line">                <span class="keyword">if</span> (!flow) <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">return</span> tmp - flow;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;<span class="built_in">memset</span>(head,<span class="number">-1</span>,<span class="keyword">sizeof</span>(head));<span class="built_in">memset</span>(nxt,<span class="number">-1</span>,<span class="keyword">sizeof</span>(nxt));ptr = <span class="number">0</span>;&#125;</span><br><span class="line">    FlowGraph() &#123; clear(); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">add_edge</span><span class="params">(<span class="keyword">int</span> uu,<span class="keyword">int</span> vv,ll ww = <span class="number">1</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123; padd_edge(uu,vv,ww);padd_edge(vv,uu,<span class="number">0</span>); &#125;</span><br><span class="line">    <span class="function">ll <span class="title">dinic</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;t = t;ll ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (bfs(s,t)) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">memcpy</span>(cur,head,<span class="keyword">sizeof</span>(cur));</span><br><span class="line">            ret += dfs(s,inf);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; g;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">id</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span> </span>&#123;<span class="keyword">return</span> ((x - <span class="number">1</span>) * m + y) * <span class="number">2</span> - <span class="number">1</span>;&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">People</span> &#123;</span><span class="keyword">int</span> x,y;ll t;&#125;;</span><br><span class="line"><span class="built_in">vector</span>&lt;People&gt; a,b;<span class="keyword">char</span> mp[K][K];</span><br><span class="line"><span class="keyword">int</span> dis[K][K][K][K];</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> dx[] = &#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">0</span>&#125;,dy[] = &#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">-1</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">proc</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mp[x][y] == <span class="string">'#'</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">queue</span>&lt;pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;&gt; q;q.push(&#123;x,y&#125;);dis[x][y][x][y] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (!q.empty())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> cx = q.front().first,cy = q.front().second;q.pop();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">4</span>;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> nx = cx + dx[i],ny = cy + dy[i];</span><br><span class="line">            <span class="keyword">if</span> (nx &lt; <span class="number">1</span> || nx &gt; n || ny &lt; <span class="number">1</span> || ny &gt; m || mp[nx][ny] == <span class="string">'#'</span> ||</span><br><span class="line">                dis[x][y][nx][ny] != <span class="number">-1</span>) <span class="keyword">continue</span>;</span><br><span class="line">                dis[x][y][nx][ny] = dis[x][y][cx][cy] + <span class="number">1</span>,q.push(&#123;nx,ny&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 房子的点 1~2nm,男人的点 2nm+1~2nm+l1,女人的点2nm+l1+1~2nm+l1+l2,S=0,T=2nm+l1+l2+1</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(ll lim)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> st = <span class="number">0</span>,s = <span class="number">0</span>,t = <span class="number">2</span> * n * m + l1 + l2 + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>;j &lt;= m;j++) g.add_edge(id(i,j),id(i,j) + <span class="number">1</span>); <span class="comment">// 限流</span></span><br><span class="line">    st = <span class="number">2</span> * n * m + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; l1;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        g.add_edge(s,i + st);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">1</span>;x &lt;= n;x++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">1</span>;y &lt;= m;y++)</span><br><span class="line">                <span class="keyword">if</span> (dis[a[i].x][a[i].y][x][y] != <span class="number">-1</span> &amp;&amp; </span><br><span class="line">                    dis[a[i].x][a[i].y][x][y] * a[i].t &lt;= lim)</span><br><span class="line">                    g.add_edge(i + st,id(x,y));</span><br><span class="line">    &#125;</span><br><span class="line">    st += l1;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; l2;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        g.add_edge(i + st,t);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">1</span>;x &lt;= n;x++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">1</span>;y &lt;= m;y++)</span><br><span class="line">                <span class="keyword">if</span> (dis[b[i].x][b[i].y][x][y] != <span class="number">-1</span> &amp;&amp; </span><br><span class="line">                    dis[b[i].x][b[i].y][x][y] * b[i].t &lt;= lim)</span><br><span class="line">                    g.add_edge(id(x,y) + <span class="number">1</span>,i + st);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(ll mid)</span></span></span><br><span class="line"><span class="function"></span>&#123; g.clear();build(mid);<span class="keyword">return</span> g.dinic(<span class="number">0</span>,<span class="number">2</span> * n * m + l1 + l2 + <span class="number">1</span>) == l1; &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; l1 &gt;&gt; l2;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">abs</span>(l1 - l2) != <span class="number">1</span>) &#123;<span class="built_in">cout</span> &lt;&lt; <span class="number">-1</span> &lt;&lt; <span class="built_in">endl</span>;<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) <span class="built_in">cin</span> &gt;&gt; (mp[i] + <span class="number">1</span>);</span><br><span class="line">    ll l = <span class="number">0</span>,r = <span class="number">0</span>,ans = <span class="number">-1</span>;People t1;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; t1.x &gt;&gt; t1.y &gt;&gt; t1.t;(l1 &gt; l2 ? b : a).push_back(t1);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= l1;i++)</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; t1.x &gt;&gt; t1.y &gt;&gt; t1.t,a.push_back(t1),r = max(r,t1.t);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= l2;i++)</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; t1.x &gt;&gt; t1.y &gt;&gt; t1.t,b.push_back(t1),r = max(r,t1.t);</span><br><span class="line">    r *= n * m;<span class="built_in">memset</span>(dis,<span class="number">-1</span>,<span class="keyword">sizeof</span>(dis));</span><br><span class="line">    <span class="keyword">if</span> (l1 &gt; l2) ++l2;<span class="keyword">else</span> ++l1;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>;j &lt;= m;j++) proc(i,j);</span><br><span class="line">    <span class="keyword">while</span> (l &lt;= r)</span><br><span class="line">    &#123;</span><br><span class="line">        ll mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (check(mid)) ans = mid,r = mid - <span class="number">1</span>;<span class="keyword">else</span> l = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://nikrot.github.io/2020/06/23/solution-CF446D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Nikrot">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nikrot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/23/solution-CF446D/" class="post-title-link" itemprop="url">CodeForces 446D DZY Loves Games</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-23 19:48:50" itemprop="dateCreated datePublished" datetime="2020-06-23T19:48:50+08:00">2020-06-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-27 11:07:22" itemprop="dateModified" datetime="2020-06-27T11:07:22+08:00">2020-06-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>毒瘤高斯消元</p>
<p>假设每个点都是陷阱，那么令 $A_p$ 为当前情况下到达$p$的概率，$B_{u,v}$ 为从 $u$ 到 $v$ 的概率(即 $\frac{1}{deg_u}$ )，跑矩阵快速幂即可算出最终情况下的 $A$，进一步得出答案。</p>
<p>进一步推广，重定义 $B_{u,v}$ 为从 $u$ 到 $v$ ，路径之间不经过任何其他陷阱的概率。发现珂以在枚举 $u$ 时用高斯消元计算 $B_{u,v}$。</p>
<p>柿子为:</p>
<p><script type="math/tex">B_{u,v}=\sum\limits_{(u,v')\in G,v'\notin Trap}\frac{B_{u,v'}}{deg_{v'}}+P(v')</script>,</p>
<p>其中$P(v’)$为$v’$作为本轮起点的概率，将上式中的求和移到等式左边就可以消元了。定义起点为与陷阱直接相连的点。同时不能算入$v’\in Trap$的情况，否则会算重。</p>
<p>第一轮时只有$1$一个点是”陷阱”,故除$1$外所有点作为起点的概率为$1$</p>
<p>观察到每次消元只有常数项不同，故珂以把$n$次消元放到一起，这样就不用$O(n^4)$做了。</p>
<p>另外最后快速幂的时候计算的是只包括陷阱点的$B$矩阵。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">605</span>,M = <span class="number">100005</span>;</span><br><span class="line"><span class="keyword">int</span> n,m,kk,a[N],idx,num[N],u[M],v[M],deg[N];</span><br><span class="line"><span class="keyword">double</span> f[N][N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Gauss</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!f[i][i])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> mx = i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span>;j &lt;= n;j++) <span class="keyword">if</span> (<span class="built_in">abs</span>(f[j][i]) &gt; <span class="built_in">abs</span>(f[mx][i])) mx = j;</span><br><span class="line">            <span class="keyword">if</span> (mx != i) <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span>;j &lt;= n + idx + <span class="number">1</span>;j++) swap(f[mx][j],f[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!f[i][i]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">double</span> tmp = f[i][i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i;j &lt;= n + idx + <span class="number">1</span>;j++) f[i][j] /= tmp;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>;j &lt;= n;j++)</span><br><span class="line">            <span class="keyword">if</span> (j != i &amp;&amp; f[j][i])</span><br><span class="line">            &#123;</span><br><span class="line">                tmp = f[j][i];</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = i;k &lt;= n + idx + <span class="number">1</span>;k++) f[j][k] -= tmp * f[i][k];</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Matrix</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> l,w;</span><br><span class="line">    <span class="keyword">double</span> a[N][N] = &#123;&#125;;</span><br><span class="line">    <span class="keyword">double</span> *<span class="keyword">operator</span>[](<span class="keyword">const</span> <span class="keyword">size_t</span> &amp;s) &#123;<span class="keyword">return</span> a[s];&#125;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> *<span class="keyword">operator</span>[](<span class="keyword">const</span> <span class="keyword">size_t</span> &amp;s) <span class="keyword">const</span> &#123;<span class="keyword">return</span> a[s];&#125;</span><br><span class="line">    Matrix (<span class="keyword">int</span> l,<span class="keyword">int</span> w) :l(l),w(w) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">Matrix <span class="keyword">operator</span>* (<span class="keyword">const</span> Matrix &amp;a,<span class="keyword">const</span> Matrix &amp;b)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">Matrix <span class="title">c</span><span class="params">(a.l,b.w)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= a.l;i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>;j &lt;= b.w;j++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>;k &lt;= a.w;k++) c[i][j] = (c[i][j] + a[i][k] * b[k][j]);</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Matrix <span class="title">qpow</span><span class="params">(Matrix a,<span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">Matrix <span class="title">ret</span><span class="params">(a.l,a.w)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= a.l;i++) ret[i][i] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (b)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>) ret = ret * a;</span><br><span class="line">        a = a * a;b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; kk;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) &#123; <span class="built_in">cin</span> &gt;&gt; a[i];<span class="keyword">if</span> (a[i]) a[i] = ++idx,num[idx] = i; &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++) <span class="built_in">cin</span> &gt;&gt; u[i] &gt;&gt; v[i],++deg[u[i]],++deg[v[i]];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> x = u[i],y = v[i];</span><br><span class="line">        <span class="keyword">if</span> (!a[x]) f[y][x] -= <span class="number">1.0</span> / deg[x];<span class="keyword">else</span> f[y][a[x] + n] += <span class="number">1.0</span> / deg[x];</span><br><span class="line">        <span class="keyword">if</span> (!a[y]) f[x][y] -= <span class="number">1.0</span> / deg[y];<span class="keyword">else</span> f[x][a[y] + n] += <span class="number">1.0</span> / deg[y];</span><br><span class="line">    &#125;</span><br><span class="line">    f[<span class="number">1</span>][n + idx + <span class="number">1</span>] = <span class="number">1</span>;<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) ++f[i][i];</span><br><span class="line">    Gauss();</span><br><span class="line">    Matrix a(1,idx),b(idx,idx);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= idx;i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>;j &lt;= idx;j++) b[i][j] = f[num[j]][i + n];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= idx;i++) a[<span class="number">1</span>][i] = f[num[i]][n + idx + <span class="number">1</span>];</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%.7lf"</span>,(a * qpow(b,kk - <span class="number">2</span>))[<span class="number">1</span>][idx]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://nikrot.github.io/2020/06/20/20200606-operate/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Nikrot">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nikrot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/20/20200606-operate/" class="post-title-link" itemprop="url">Operate</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-20 21:03:34" itemprop="dateCreated datePublished" datetime="2020-06-20T21:03:34+08:00">2020-06-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-23 20:53:24" itemprop="dateModified" datetime="2020-06-23T20:53:24+08:00">2020-06-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>题意：给出一个元素互不相同的数列$A$，要求支持三种操作: </p>
<ol>
<li>查找有多少个$A_i$满足其前面至少有一个比它大的数</li>
<li>查询序列的逆序对数量</li>
<li>将所有小于等于$L$的数拿出来，升序排序后按顺序放回原来的位置</li>
</ol>
<p>神仙题…</p>
<p>做法：</p>
<p>首先把数列和修改操作的$L$离散化。此时$A$是一个$1$~$n$的排列。发现如果一次修改操作的$L$比之前小则本次操作无意义。因此我们记当前排好序的位置为$P$。如果$L\le P$则忽略修改，否则令$P=L$。</p>
<p>对于询问2，将逆序对的贡献算在逆序对左边的数字上(即较大的数字上)，则所有$\le P$的数字对当前询问全部没有贡献（比它小的已经在它前面了），而$&gt; P$的数字的贡献要计算，因为在每一个$&gt; L$的数字的右侧，比该数字小的数字的数量不变。</p>
<p>对于询问1也从相同的角度去考虑。首先大于$L$的数字对询问的贡献不变，但是答案要加上$L-C$，其中$C$为在<strong>所有</strong>大于$L$的数的左边的$\le L$的数的个数。(这$C$个数对于询问贡献为0)</p>
<p>用树状数组辅助处理即可。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">500005</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(T &amp;num)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    num = <span class="number">0</span>;<span class="keyword">int</span> ch = getchar();T fl = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch) &amp;&amp; ch != <span class="number">45</span>) ch = getchar();</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="number">45</span>) fl = <span class="number">-1</span>,ch = getchar();</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) </span><br><span class="line">    &#123;num = (num &lt;&lt; <span class="number">3</span>) + (num &lt;&lt; <span class="number">1</span>) + (ch - <span class="number">48</span>);ch = getchar();&#125;</span><br><span class="line">    num *= fl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">writeln</span><span class="params">(T num)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> buf[<span class="number">55</span>];<span class="keyword">static</span> <span class="keyword">int</span> idx = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (num == <span class="number">0</span>) &#123;<span class="built_in">putchar</span>(<span class="number">48</span>);<span class="built_in">putchar</span>(<span class="string">'\n'</span>);<span class="keyword">return</span>;&#125;</span><br><span class="line">    <span class="keyword">if</span> (num &lt; <span class="number">0</span>) &#123;<span class="built_in">putchar</span>(<span class="number">45</span>);num = -num;&#125;</span><br><span class="line">    <span class="keyword">while</span> (num) &#123; buf[idx++] = num % <span class="number">10</span>;num /= <span class="number">10</span>; &#125;</span><br><span class="line">    <span class="keyword">while</span> (idx) <span class="built_in">putchar</span>(buf[--idx] + <span class="number">48</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(<span class="string">'\n'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n,m,a[N],num[N],pos[N],mn[N],ok[N];ll inv[N];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BIT</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;<span class="keyword">return</span> x &amp; -x;&#125;</span><br><span class="line">    <span class="keyword">int</span> c[N];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> v)</span> </span>&#123;<span class="keyword">while</span> (x &lt;= n) c[x] += v,x += lowbit(x);&#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;<span class="keyword">while</span> (x) ret += c[x],x -= lowbit(x);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; t;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    freopen(<span class="string">"operate.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</span><br><span class="line">    freopen(<span class="string">"operate.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);  </span><br><span class="line">    read(n);read(m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) read(a[i]),num[i] = a[i];</span><br><span class="line">    sort(num + <span class="number">1</span>,num + n + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) a[i] = lower_bound(num + <span class="number">1</span>,num + n + <span class="number">1</span>,a[i]) - num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n;i &gt; <span class="number">0</span>;--i) &#123; pos[a[i]] = i;inv[a[i]] = t.query(a[i]);t.add(a[i],<span class="number">1</span>); &#125;</span><br><span class="line">    mn[n + <span class="number">1</span>] = n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n;i &gt; <span class="number">0</span>;--i) mn[i] = min(pos[i],mn[i + <span class="number">1</span>]),inv[i] += inv[i + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>,mx = <span class="number">0</span>;i &lt;= n;i++) <span class="keyword">if</span> (mx &gt; a[i]) ok[a[i]] = <span class="number">1</span>;<span class="keyword">else</span> mx = a[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n;i &gt; <span class="number">0</span>;--i) ok[i] += ok[i + <span class="number">1</span>];</span><br><span class="line">    <span class="built_in">memset</span>(t.c,<span class="number">0</span>,<span class="keyword">sizeof</span>(t.c));</span><br><span class="line">    <span class="keyword">int</span> cur_sorted = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> op,t1;read(op);</span><br><span class="line">        <span class="keyword">if</span> (op == <span class="number">3</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            read(t1);t1 = upper_bound(num + <span class="number">1</span>,num + n + <span class="number">1</span>,t1) - num - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (t1 &lt;= cur_sorted) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = cur_sorted + <span class="number">1</span>;i &lt;= t1;i++) t.add(pos[i],<span class="number">1</span>);</span><br><span class="line">            cur_sorted = t1;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (op == <span class="number">1</span>)</span><br><span class="line">            writeln(ok[cur_sorted + <span class="number">1</span>] + cur_sorted - t.query(mn[cur_sorted + <span class="number">1</span>]));</span><br><span class="line">        <span class="keyword">else</span> writeln(inv[cur_sorted + <span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://nikrot.github.io/2020/06/02/solution-CF1303F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Nikrot">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nikrot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/02/solution-CF1303F/" class="post-title-link" itemprop="url">solution-CF1303F</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-02 19:48:52" itemprop="dateCreated datePublished" datetime="2020-06-02T19:48:52+08:00">2020-06-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-27 11:03:06" itemprop="dateModified" datetime="2020-06-27T11:03:06+08:00">2020-06-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Codeforces-1303F-Number-of-Components"><a href="#Codeforces-1303F-Number-of-Components" class="headerlink" title="Codeforces 1303F Number of Components"></a>Codeforces 1303F Number of Components</h1><p>题意：有一个$n\times m$的矩阵，初始时矩阵里的元素全部是0。如果相邻两个格子颜色相同那么它们属于同一个连通块。现在给出$q$个询问，每次将矩阵在$x_i,y_i$的值修改为$c_i$,且保证$c_i$单调不降，问每次询问后矩阵的连通块数量。</p>
<p>将单一询问拆成在该位置上添加新的数字和删除旧的数字，然后对答案进行差分。</p>
<p>添加数字的询问很好做。关键在于如何删除旧的数字。</p>
<p>考虑到因为所有删除一个颜色的询问都会发生在所有添加该颜色之后(忽略新元素和旧元素相等的询问)，我们珂以倒着做一遍DSU，把删除操作也当成添加操作，然后再算上它的贡献。但是注意它的贡献要乘$-1$。</p>
<p>感性理解正确性的关键在于：每种颜色的子图互相独立。</p>
<p>随后统计并输出即可。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">305</span>,M = <span class="number">2000005</span>,dx[] = &#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">0</span>&#125;,dy[] = &#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">-1</span>&#125;;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(T &amp;num)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    num = <span class="number">0</span>;<span class="keyword">int</span> ch = getchar();T fl = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch) &amp;&amp; ch != <span class="number">45</span>) ch = getchar();</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="number">45</span>) fl = <span class="number">-1</span>,ch = getchar();</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) </span><br><span class="line">    &#123;num = (num &lt;&lt; <span class="number">3</span>) + (num &lt;&lt; <span class="number">1</span>) + (ch - <span class="number">48</span>);ch = getchar();&#125;</span><br><span class="line">    num *= fl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">write</span><span class="params">(T num)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> buf[<span class="number">55</span>];<span class="keyword">static</span> <span class="keyword">int</span> idx = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (num == <span class="number">0</span>) &#123;<span class="built_in">putchar</span>(<span class="number">48</span>);<span class="keyword">return</span>;&#125;</span><br><span class="line">    <span class="keyword">if</span> (num &lt; <span class="number">0</span>) &#123;<span class="built_in">putchar</span>(<span class="number">45</span>);num = -num;&#125;</span><br><span class="line">    <span class="keyword">while</span> (num) &#123; buf[idx++] = num % <span class="number">10</span>;num /= <span class="number">10</span>; &#125;</span><br><span class="line">    <span class="keyword">while</span> (idx) <span class="built_in">putchar</span>(buf[--idx] + <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n,m,q,f[M * <span class="number">2</span>],num,id[N][N],a[N][N],ans[M],idx;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">getf</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123;<span class="keyword">return</span> f[v] == v ? v : f[v] = getf(f[v]);&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Query</span> &#123;</span><span class="keyword">int</span> x,y,cur,pre;&#125; qq[M];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123; x = getf(x);y = getf(y);<span class="keyword">if</span> (x != y) f[x] = y,--num; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">4</span>;i++)</span><br><span class="line">        <span class="keyword">if</span> (a[x][y] == a[x + dx[i]][y + dy[i]]) merge(id[x][y],id[x + dx[i]][y + dy[i]]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);<span class="built_in">cin</span>.tie(<span class="number">0</span>);</span><br><span class="line">    read(n);read(m);read(q);</span><br><span class="line">    <span class="keyword">int</span> t1,t2,t3;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= q;i++)</span><br><span class="line">    &#123; read(t1);read(t2);read(t3);qq[i] = &#123;t1,t2,t3,a[t1][t2]&#125;;a[t1][t2] = t3; &#125;</span><br><span class="line">    ans[<span class="number">0</span>] = <span class="number">1</span>;<span class="built_in">memset</span>(a,<span class="number">-1</span>,<span class="keyword">sizeof</span>(a));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>;j &lt;= m;j++) a[i][j] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= q;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (qq[i].pre == qq[i].cur) <span class="keyword">continue</span>;</span><br><span class="line">        num = <span class="number">1</span>;a[qq[i].x][qq[i].y] = qq[i].cur;</span><br><span class="line">        id[qq[i].x][qq[i].y] = ++idx;f[idx] = idx;</span><br><span class="line">        check(qq[i].x,qq[i].y);ans[i] = num;</span><br><span class="line">    &#125;</span><br><span class="line">    idx = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>;j &lt;= m;j++) id[i][j] = ++idx,f[idx] = idx;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>;j &lt;= m;j++) check(i,j);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = q;i &gt; <span class="number">0</span>;--i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (qq[i].pre == qq[i].cur) <span class="keyword">continue</span>;</span><br><span class="line">        num = <span class="number">1</span>;a[qq[i].x][qq[i].y] = qq[i].pre;</span><br><span class="line">        id[qq[i].x][qq[i].y] = ++idx;f[idx] = idx;</span><br><span class="line">        check(qq[i].x,qq[i].y);ans[i] -= num;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= q;i++) ans[i] += ans[i - <span class="number">1</span>],write(ans[i]),<span class="built_in">putchar</span>(<span class="string">'\n'</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>另:如果$c_i$不单调递减则算法正确性错误。Hack数据如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">3 3 7</span><br><span class="line">2 1 1</span><br><span class="line">2 2 1</span><br><span class="line">2 3 1</span><br><span class="line">2 2 2</span><br><span class="line">3 2 1</span><br><span class="line">1 2 1</span><br><span class="line">2 2 1</span><br></pre></td></tr></table></figure>
<p>对于第六次询问输出了8，实际上应该输出9</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://nikrot.github.io/2020/05/31/solution-CF1033E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Nikrot">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nikrot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/31/solution-CF1033E/" class="post-title-link" itemprop="url">solution-CF1033E</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-31 08:21:23" itemprop="dateCreated datePublished" datetime="2020-05-31T08:21:23+08:00">2020-05-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-23 20:57:11" itemprop="dateModified" datetime="2020-06-23T20:57:11+08:00">2020-06-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Codeforces-1033E-Hidden-Bipartite-Graph"><a href="#Codeforces-1033E-Hidden-Bipartite-Graph" class="headerlink" title="Codeforces 1033E Hidden Bipartite Graph"></a>Codeforces 1033E Hidden Bipartite Graph</h1><p>神奇的构造题…</p>
<p>题意：给你一个图的点数$n$,你珂以进行不超过$20000$次询问，每次询问一个点集$S$,得到有多少条边的两个端点都在$S$内。问这个图是不是二分图。如果是，输出二分图黑白染色后的黑点集合或白点集合，如果不是，输出一个奇环。</p>
<p>做法:设有两个<strong>不相交</strong>的点集$A,B$，询问的函数为$Q$,则$A,B$间的点数为$E(A,B)=Q(A\cup B)-Q(A)-Q(B)$。如果要获得$A,B$之间任意一条边的话(前提是它们之间有边)，珂以先将$A$划分成两个大小大致相同的点集$A’,A’’$，询问$E(A’,B)$，若其不为0则令$A=A’$,否则令$A=A’’$进行递归。最后等$A$只剩下一个点时再对$B$进行相同操作，等$B$也只剩下一个点时就珂以得到一条边。</p>
<p>通过上述方法，先令$S=\{1\}$，每次询问$S$和$V-S$（$V$为顶点集）之间的一条边并将$V-S$中的对应顶点加入$S$,珂以获得一棵原图的生成树。对生成树黑白染色，分别询问黑点集合和白点集合内部有没有边。若两者无，则原图为二分图，直接输出黑点(或白点)集合即可。</p>
<p>否则，不失一般性地假设白点集合$W$内有边，枚举每一个点$P$,判断$E(\{P\},W-\{P\})\ne 0$是否成立。若成立则用上述二分方法找到$\{P\}$和$W-\{P\}$之间的一条边并输出即可。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">605</span>;</span><br><span class="line"><span class="keyword">int</span> n,ss[<span class="number">20005</span>],idx;</span><br><span class="line"><span class="built_in">map</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;,<span class="keyword">int</span>&gt; mp;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ask</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (v.size() &lt;= <span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    sort(v.begin(),v.end());</span><br><span class="line">    <span class="keyword">int</span> &amp;id = mp[v];<span class="keyword">if</span> (id) <span class="keyword">return</span> ss[id];</span><br><span class="line">    id = ++idx;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"? "</span> &lt;&lt; v.size() &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;i : v) <span class="built_in">cout</span> &lt;&lt; i &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">int</span> ret;<span class="built_in">cin</span> &gt;&gt; ret;<span class="keyword">if</span> (ret == <span class="number">-1</span>) <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> ss[id] = ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ask</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; a,<span class="keyword">const</span> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;i : b) a.push_back(i);</span><br><span class="line">    sort(a.begin(),a.end());a.erase(unique(a.begin(),a.end()),a.end());</span><br><span class="line">    <span class="keyword">return</span> ask(a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">chk</span><span class="params">(<span class="keyword">const</span> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;a,<span class="keyword">const</span> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;b)</span></span></span><br><span class="line"><span class="function"></span>&#123; <span class="keyword">return</span> ask(a,b) - ask(a) - ask(b); &#125;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; e[N];</span><br><span class="line"><span class="keyword">bool</span> vis[N];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fnd</span><span class="params">(<span class="keyword">const</span> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;a,<span class="keyword">const</span> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (a.size() == <span class="number">1</span>) <span class="keyword">return</span> a[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">int</span> f = a.size() / <span class="number">2</span>;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; c(a.begin(),a.begin() + f);</span><br><span class="line">    <span class="keyword">if</span> (chk(c,b)) <span class="keyword">return</span> fnd(c,b);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> fnd(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;(a.begin() + f,a.end()),b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> clr[N],fa[N],dep[N];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; s[<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> f)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    fa[pos] = f;s[clr[pos] = clr[f] ^ <span class="number">1</span>].push_back(pos);dep[pos] = dep[f] + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;i : e[pos])</span><br><span class="line">        <span class="keyword">if</span> (i != f) dfs(i,pos);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);srand(time(<span class="number">0</span>));</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line">    vis[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; a,b;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>;j &lt;= n;j++)</span><br><span class="line">            <span class="keyword">if</span> (vis[j]) b.push_back(j);<span class="keyword">else</span> a.push_back(j);</span><br><span class="line">        <span class="keyword">int</span> t1 = fnd(a,b),t2 = fnd(b,&#123;t1&#125;);</span><br><span class="line">        e[t1].push_back(t2);e[t2].push_back(t1);vis[t1] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    dfs(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">bool</span> ok = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (ask(s[<span class="number">0</span>])) ok = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (ask(s[<span class="number">1</span>])) ok = <span class="number">0</span>,swap(s[<span class="number">0</span>],s[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">if</span> (ok)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"Y "</span> &lt;&lt; s[<span class="number">0</span>].size() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;i : s[<span class="number">0</span>]) <span class="built_in">cout</span> &lt;&lt; i &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> t1,t2;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;i : s[<span class="number">0</span>])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; a;<span class="keyword">for</span> (<span class="keyword">auto</span> &amp;j : s[<span class="number">0</span>]) <span class="keyword">if</span> (i != j) a.push_back(j);</span><br><span class="line">        <span class="keyword">if</span> (chk(a,&#123;i&#125;)) &#123;t1 = i,t2 = fnd(a,&#123;i&#125;);<span class="keyword">break</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; ans,tmp;</span><br><span class="line">    <span class="keyword">if</span> (dep[t1] &lt; dep[t2]) swap(t1,t2);</span><br><span class="line">    <span class="keyword">while</span> (dep[t1] &gt; dep[t2]) ans.push_back(t1),t1 = fa[t1];</span><br><span class="line">    <span class="keyword">while</span> (t1 != t2) ans.push_back(t1),tmp.push_back(t2),t1 = fa[t1],t2 = fa[t2];</span><br><span class="line">    ans.push_back(t1);reverse(tmp.begin(),tmp.end());</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;i : tmp) ans.push_back(i);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"N "</span> &lt;&lt; ans.size() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;i : ans) <span class="built_in">cout</span> &lt;&lt; i &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Nikrot"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Nikrot</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">21</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Nikrot</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.2.1
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://pisces.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.7.1
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


</body>
</html>
